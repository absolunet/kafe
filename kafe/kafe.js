/*                                                                                                             
                                                    .   ..  ..                                                 
                             ....',;;:::clccllodddoooddoolodddocllclolllodollccccc::;,'...                     
                   ..,;:codddollllcccc:;,,'','........   ....    ...........';:c:cllodddxxkxxdolc;'..          
          ..';:::ldxOOOkxd:............                                                   .;xocodxkkkxd;.      
      ,ldkkxolcldkk0XNKd;,..'xOxdc;''......                                        .....',,:ll;:ccl:,...:;     
     'Ol'',;:;;:ccdkO00Oxdc;':ldolcllc:::ol.                             .. ...'.',,';::;c:::::''........c.    
     dk'.,,,,;;;;,,;,',;:coolcccc:;cc;;,,',;,'....... ......   .   .........................        ..   :c.   
    .0d.cl:,.'..''.'',;,',,''...'....',''.''.'''....'.............    .                                  ,x.   
   .oK;.,clc;'...................................... ....                                                .xk.  
   lKOc'::;,,;,,'..... .                                                                               ....l.  
  xXd,';;,;:;'......                                                                            .    .     .:  
 .xKOxlc:;;,.'.............                                             .                 ..          .':,'.   
  .,xXd,,;:cccl:;;;,'.'....   .                         ..'.......','......                ...';::;;;;;:o'     
    'Ko.........',::ccccclooloolcc::,''''','.......................................';,;;;,;;:,'....    .:.     
    .0d...........     .......'',,;;;;:::::::::::;;;;:ccc:;::::,,,'...................                 ;c      
    .kx.............. .                                                                                :;      
     ,:........                                                                                       ;O'      
     ':........                                                                                     .oKd.      
     .xo'...                                                                                   ..,;:cccx:      
     ;xdxxxdlc:;,''.......                                                              ....',;:;;;,'.;d,      
     'kl:cc::cccllllllolccc:::;;;,''.....                                      .......'',,,;;,,,,'''..;d'      
     .xlcolc:c:;::;;;;,,,,,,,;;;;,,,,,''''''','','..'..............''''',,'''''''''''''''''''''.',,''.:d.      
     .llcodl:::::;;:;,,,;;,,,'''''''',''''....''',;,,'''''''''...'''.''..''..........''.'''',,',,,,''.:o.      
      ldclolc::::;;:;;;,,,,,,,,'','..''....'cdxkOO0OOxc,.....................'..'...'''',;,,,,,;,,,''':c.      
      :dclllc:c::;;;;;,,;;,,,,,''''..''..,oOKKKKKKKKKKK0xc'........................''''''',,,',,,,,,..::       
      'c:lkKKK00Ol;;:;::;;;;;,,,'.....':d0KKKK00K00KKKKKKKOl'.'...........':oddxxl'...'''''',,,,,,,,'.c:       
      .c;ckXXKKXKo;::;;;:;,,,,,,,'''';xKKK000KK0KKK0KK000KKKd'.''...''...:xKKKKKXd...''''''',,,',,,,''l;       
      .c;:xXXXKX0l;;;;,,,,,,,,,'''',lOKKK0KKK0KKKKKK00KK0KKK0d,........'cOKKKKKK0l...'''''''','',,,'.'c'       
       ;ccxKXXXXKo;;;,,,,,,,,,,''';dKKKKK0K0KKKKKKK0000KKKKKKKd,.......'xKKKKKKKk;....''''''''''',,'.';.       
       ;ccxKXKKXKo;:;;:;;;,;,,,'';xKKKKKKK0KKOxdxO0KKKK00000KKKo.......;kKKKK0o:;'.....''''',,,;;,,'.';.       
       ,:;o0XKKK0c;::clll:;,,,'':kKKKKKK0KK0o,...'l0KK0K0KK00KKO:....',d0K0K0x;,'.......,:ok00000kl,.',.       
       ,c;cOXXKK0l,,l0XKKKk;'',lOKKKKKKKKK0d'.....'l0K0KKK00KKKKx,.'lO0KK0000000k;....'ckKKKKKKKKKKx;',        
       'c:ckKXKXXx:;c0XKXX0l',d0KKKKKKKKKKx,.......,dKK000000KKK0l.:kKKK000000KKk;...;x0KKKKKKKKKKKKd:'        
       .c:cxKXXXXk;,c0XKKK0l,:OKKKKKK00KKk:.........cOKK000K000KKk,;k000000000OOd'..;OKKKK0kdx0KKKKKxc'        
       .;;cdKXKKX0c,dKXKKKx,,oKKK0000KKK0l'...'.....;kKK0000000KKO:.,,cOKKKKOc,,'..,xKKKKOc'.'lOKKK0o;.        
       .:;;o0XKKX0lcOXKKX0l';kKKKKK0KKKKk;...........oKKKK00000KK0c...;kK0K0l'....'l0KKKk;..',o0KKKOc;.        
        ;::cxKXXXKO0KKKXKd;';xKKKKKK0KKOc............,xKK0KK000KKKl...:OKKK0c.....:OKKKOc,;lx0KKKKKd,,.        
        'c:cd0XXXXKKKKKXO:',;xKKKKK00K0o'.............c0KKKKKKK0KKd'..cOKKKO:....'dKK00000KKKKKKKOo'':.        
        .::co0XXXKKXXKKKK0o,'l0KK000KKx,.......'......;kKK0K000KKKo...lOKKKO:....,kKK000KKKKK0kdc,'.,:.        
         ;::ckXXXXXK00XKKKKx;'o0K00KK0c..........''...'oKK00000KK0c..'d0KKK0c....:OKK00K0Odlc;,,,:;.,:.        
         :l:cdKXXXXOcckXXKKKk;'cOKKKOl'..'..:xkd:'.....c0K00000KK0l..'dKK0K0l....:OKKKKOl'...'',oKk,,:.        
         ;l:cxKXXXX0o;cOXKKKKx,.;okd;......:OKKK0o'....,xKKK000KKO:..'d0K0K0l'...;kKKKKk,.....;dKKd,::         
         ,o::lOXXXX0l;;oKKKKK0c'''''..'''..c0KKKK0c....'oKKK00KK0x,..,dKKKK0l....'d0K0K0kl::lx0KXO:'lc         
         .o:;lkXXXXXx:;cOXKKK0o,'''''''....;kKK0KKx,....:0KK000K0d'..,dKKKK0l.....c0KK00KKKKKKKK0c..oc         
         .olcloxO00K0o::xKXKKXOc'''''.......;x0KKKk,....'xKK000K0l...'dKK0KKd,....'lOKKKKKKKKKOd:,''o:         
         .lkcllllccclc;,:ododxdc,''''........';okkc......c0K00KKx;....oKKKKKk;......;oxkOkkxo:;,,,';x,         
          :0dlclolcol:::::;,''',,'''''...................;kKK0K0l.....:odddo:'.........''''''''',,.:x'         
          .l0Oo:::::ccc:;:;,,'',,,,,'''..'...............'o0KKKx,......................'''''''''''.ok.         
            lXKo;,,,,;;;:;,;;;,,,,,,,,''''''..............,dKK0c.........................''',,;:oxkd,          
            '0Xd:,........'',:cc::::::;;;,,,''''.''........'cl;..........'...'''',,,,,;;::;:ccccl0x'           
            .xXxc:'.....     ........'',,;;;;:llllccc:;;;;,'.......'''''..'..............       'k;            
             .OKl;,........                                                                     cx.            
              oXd;,.....                                                                       .dd             
               'Od;,.....                                                                      .oc             
               .kk:;'...                                                                       .o;             
                 oKo;;,.....                                                                  .o,              
                 .cxl:;,......                                                               .l'               
                   .:ddc,,.......                                                         ..,c:.               
                      .';::;,......                                                 ....''..                   
                           ..,,,,'..... ...                                  ...,;:;,..                        
                                ....,,,'''''......           ...........',;,,''..                              
                                         ....'''''',,;;;;:c:::;,,''....                                        
*/

//>>excludeStart('excludeRequire', pragmas.excludeRequire);
require([
	'libs/external/dependencies/underscore',
	'libs/external/dependencies/modernizr'
]);
//>>excludeEnd('excludeRequire');

/**
* ### Version 2-alpha
* kafe RULZ
*
* @module kafe
* @main kafe
*/
window.kafe = (function(undefined){

	var
		// check if module imported
		_exists = function _exists(name) {
			try {
				return eval("("+name+" != undefined)");
			} catch(e) {
				return false;
			}
		},

		// ie version
		_ie = (function(){
			var
				undef,
				v = 3,
				div = document.createElement('div'),
				all = div.getElementsByTagName('i')
			;
			while ((
				div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',
				all[0]
			));

			return v > 4 ? v : undef;
		}),

		// jquery methods
		_jQueryMethods = {},


		/**
		* kafe core
		*
		* @module kafe
		* @class kafe
		*/
		core = {

			/**
			* kafe version
			*
			* @property _vesyon 
			* @type String
			**/
			_vesyon: '2-alpha',

			/**
			* kafe author
			*
			* @property _griyaj 
			* @type String
			**/
			_griyaj: 'absolunet.com',

			/**
			* Versions of dependencies / kafe modules
			*
			* @property _chaje 
			* @type Object
			**/
			_chaje: {
				'dependencies.jQuery':     window.kafejQuery().jquery,
				'dependencies.underscore': window._.VERSION,
				'dependencies.Modernizr':  window.Modernizr._version
			},

			// isolate core dependencies
			dependencies: {

				/**
				* jQuery defined under window.kafejQuery  
				* ref: [http://jquery.com/](http://jquery.com/)
				*
				* @property dependencies.jQuery 
				* @type Object
				**/
				jQuery: window.kafejQuery.noConflict(true),

				/**
				* underscore.js defined under window._  
				* ref: [http://underscorejs.org/](http://underscorejs.org/)
				*
				* @property dependencies.underscore 
				* @type Object
				**/
				underscore: window._.noConflict(),

				/**
				* Modernizr defined under window.Modernizr  
				* ref: [http://modernizr.com/](http://modernizr.com/)
				*
				* @property dependencies.Modernizr 
				* @type Object
				**/
				Modernizr: window.Modernizr
			},

			cms:    {},
			ext:    {},
			plugin: {}
		}
	;
	delete window.Modernizr;



	// miscellaneous core functions
	core.fn = {

		/**
		* Create a instantiable object  
		* By John Resig (MIT Licensed)  
		* ref: [http://ejohn.org/blog/simple-class-instantiation/](http://ejohn.org/blog/simple-class-instantiation/)
		*
		* @method fn.createInstantiableObject
		* @return {Object} The instantiable object
		*/
		createInstantiableObject: function() {
			return function(args){
				if (this instanceof arguments.callee) {
					if (typeof this.init == 'function')
						this.init.apply(this, (args.callee) ? args : arguments);
				} else
					return new arguments.callee(arguments);
			};
		},


		/**
		* Return the language if available or else 'en'
		*
		* @method fn.lang
		* @param {Object} dict The dictionary to check against
		* @param {String} lang The language to check
		* @return {String} The available language
		*/
		lang: function(dict, lang) {
			lang = (!!lang) ? lang : core.env('lang');
			return (!!dict[lang]) ? lang : 'en';
		},


		/**
		* Add method as jQuery plugin
		*
		* @method fn.plugIntojQuery
		* @param {String} name The jQuery plugin name
		* @param {Object[Function]} methods Action:Method hash
		*/
		plugIntojQuery: function(name, methods) {
			var
				$  = core.dependencies.jQuery,
				id = 'kafe'+name
			;
			name = name || 'CORE';

			if ($.fn[id] === undefined) {
				_jQueryMethods[name] = {};

				$.fn[id] = function() {
					var args = $.makeArray(arguments);
					return this.each(function() {
						_jQueryMethods[name][args.shift()]( this, args );
					});
				};
			}

			$.extend(_jQueryMethods[name], methods);
		}
	};



	/**
	* Environment constants
	*
	* @method env
	* @param {String} name The constant to get/set
	* @param {String} [value] The value to set
	* @return {String} The value of the environment constant
	*/
	core.env = (function(){

		// base vals
		var _data = {
			culture: '',
			lang:    '',
			page:    '',
			tmpl:    '',
			ie:      _ie
		};

		// grab kafe env
		_data.culture = document.documentElement.id.toLowerCase()   || '';
		_data.lang    = document.documentElement.lang.toLowerCase() || '';
		_data.page    = document.documentElement.getAttribute('data-kafe-page') || '';
		_data.tmpl    = document.documentElement.getAttribute('data-kafe-tmpl') || '';
		_data.tmpl    = _data.tmpl.split(' ');

		// public method
		return function(name, value) {
			var updatable = '';

			if (value !== undefined) {

				// if not already set 
				if (!(_data[name] !== undefined && updatable.search(new RegExp(':'+name+':')) == -1)) {
					_data[name] = value;

				// throw error
				} else {
					throw core.error(new Error("kafe.env > property '"+name+"' already defined"));
				}
			}

			return _data[name];
		};
	})();


	// 
	// 
	// 
	// TODO -- ADD IE CLASSES 
	// 
	// 
	// 


	/**
	* Add module to core
	*
	* @method bonify
	* @param {Object} options The options
	*	@param {String} options.name The module name
	*	@param {String} options.version The module version
	*	@param {Object} options.obj The module itself
	*/
	core.bonify = function(options) {

		// if not already extended
		if (!_exists('core.'+options.name)) {

			core._chaje[options.name] = options.version;
			eval('this.'+options.name+' = arguments[0].obj;');

		// throw error
		} else {
			throw core.error('kafe.'+options.name+' already exists');
		}
	};


	/**
	* Add a homebrewed plugin
	*
	* @method plug
	* @param {Object} options The options
	*	@param {String} options.name The plugin name
	*	@param {String} options.version The plugin version
	*	@param {Object} options.obj The plugin itself
	*/
	core.plug = function(options) {
		options.name = 'plugin.'+options.name;
		this.bonify(options);
	};


	/**
	* Add an external plugin extension
	*
	* @method extend
	* @param {Object} options The options
	*	@param {String} options.name The plugin extension name
	*	@param {String} options.version The plugin extension version
	*	@param {Object} options.obj The plugin extension itself
	*/
	core.extend = function(options) {
		options.name = 'ext.'+options.name;
		this.bonify(options);
	};


	/**
	* Throw kafe errors
	*
	* @method error
	* @param {Error} error The error with description
	* @return {Error} error The error
	* @example
	*	kafe.error(new Error('barf'));
	*/
	core.error = function(e) {
		var msg = ((!!e.description) ? e.description : e.message);
		e.description = e.message = '<kafe:erè> : '+ ((!!msg) ? msg : 'anonim');
		return (_ie && _ie == 8) ? new Error(e) : e;
	};




	// TO REPLACE WITH REQUIRE.JS DEPENDENCIES
	core.required = function(name) { console.log(name); };

	return core;

})();